<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>Savol qo‘shish</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
    font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
    background: url('/static/main/1.png') no-repeat center center fixed;
    background-size: cover;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
}
    /* --- Fancy multi-select (groups) reused from controller add_test --- */
    .ms-container { position: relative; }
    .ms-control { display:flex; align-items:center; gap:8px; min-height:48px; width:100%; padding:10px 12px; border-radius:12px; cursor:pointer; background: rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:#fff; transition: all .25s ease; }
    .ms-control:hover { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.35); }
    .ms-placeholder { opacity:.8; }
    .ms-chips { display:flex; flex-wrap:wrap; gap:6px; }
    .ms-chip { background: rgba(0,0,0,0.25); border:1px solid rgba(255,255,255,0.25); color:#fff; padding:4px 8px; border-radius:999px; font-size:.85rem; }
    .ms-caret { margin-left:auto; opacity:.8; }
    .ms-dropdown { position:absolute; left:0; right:0; top: calc(100% + 8px); z-index:20; display:none; background: rgba(20,20,20,0.92); border:1px solid rgba(255,255,255,0.18); border-radius:12px; overflow:hidden; box-shadow:0 12px 35px rgba(0,0,0,0.35); }
    .ms-open .ms-dropdown { display:block; }
    .ms-toolbar { display:flex; gap:6px; padding:8px; border-bottom:1px solid rgba(255,255,255,0.08); align-items:center; }
    .ms-btn { background: rgba(255,255,255,0.08); color:#fff; border:1px solid rgba(255,255,255,0.18); border-radius:8px; padding:6px 10px; font-size:.8rem; cursor:pointer; }
    .ms-btn:hover { background: rgba(255,255,255,0.14); }
    .ms-count { opacity:.7; font-size:.85rem; margin-left:auto; }
    .ms-search { width:100%; padding:8px 10px; background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.18); border-radius:8px; color:#fff; }
    .ms-list { max-height: 240px; overflow:auto; padding:4px 0; }
    .ms-option { display:flex; align-items:center; gap:10px; padding:8px 10px; color:#fff; }
    .ms-option:hover { background: rgba(255,255,255,0.06); }

/* Animated background particles */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)" opacity="0.6"><animate attributeName="cy" values="20;80;20" dur="4s" repeatCount="indefinite"/></circle><circle cx="80" cy="80" r="3" fill="rgba(255,255,255,0.08)" opacity="0.4"><animate attributeName="cx" values="80;20;80" dur="6s" repeatCount="indefinite"/></circle><circle cx="50" cy="50" r="1.5" fill="rgba(255,255,255,0.12)" opacity="0.8"><animate attributeName="r" values="1.5;3;1.5" dur="3s" repeatCount="indefinite"/></circle></svg>') repeat;
    pointer-events: none;
    z-index: 1;
}
.container {
    position: relative;
    z-index: 2;
    max-width: 730px;
    margin: 38px auto;
    padding: 42px 30px 18px 30px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(20px);
    border-radius: 22px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    animation: fadeIn 0.7s;
}
@keyframes fadeIn { from { opacity: 0;} to { opacity: 1;} }
h2 {
    text-align: center;
    color: #232e3a;
    font-size: 2.26rem;
    font-weight: 700;
    margin-bottom: 32px;
    letter-spacing: 0.7px;
}
label {
    display: block;
    margin-top: 20px;
    margin-bottom: 7px;
    font-weight: 600;
    color: #23334b;
    font-size: 1.08rem;
}
select, input[type="number"], textarea, input[type="file"] {
    width: 100%;
    padding: 13px 14px;
    border: 1.7px solid #e2e8f0;
    border-radius: 11px;
    font-size: 1.12rem;
    background: #f6fafd;
    margin-bottom: 2px;
    transition: border-color 0.19s, box-shadow 0.19s;
}
select:focus, textarea:focus, input[type="number"]:focus {
    border-color: #1976d2;
    outline: none;
    box-shadow: 0 0 0 2px #e3f0fc;
    background: #fff;
}
textarea {
    resize: vertical;
    min-height: 85px;
    font-size: 1.18rem;
}
.textarea-wrapper {
    position: relative;
    width: 100%;
}
.formula-calc-btn {
    position: absolute;
    right: 12px;
    top: 12px;
    width: 36px;
    height: 36px;
    background: #e3f2fd;
    border: 1.5px solid #b6dafc;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.15s;
    z-index: 10;
    box-shadow: 0 2px 8px 0 rgba(49,130,206,0.08);
}
.formula-calc-btn:hover { background: #bbdefb; }
.formula-calc-btn svg {
    width: 22px; height: 22px; color: #1976d2;
}
.formula-popup {
    display: none;
    position: absolute;
    left: 100%;
    top: 0;
    margin-left: 10px;
    background: #fff;
    border: 2px solid #b6dafc;
    box-shadow: 0 4px 22px 0 rgba(25, 118, 210, 0.18);
    border-radius: 14px;
    padding: 15px 14px 12px 14px;
    min-width: 320px;
    max-width: 470px;
    max-height: 340px;
    overflow-y: auto;
    grid-template-columns: repeat(auto-fill, minmax(56px,1fr));
    display: grid;
    grid-gap: 7px;
    z-index: 99;
}
.formula-popup.open {
    display: grid;
}
.formula-popup button {
    background: #f7fbff;
    border: 1.2px solid #b6dafc;
    color: #1976d2;
    padding: 8px 10px;
    border-radius: 7px;
    font-size: 1.24rem;
    min-width: 38px;
    cursor: pointer;
    transition: background 0.14s, color 0.14s, box-shadow 0.13s;
    box-shadow: 0 1px 7px 0 rgba(25,118,210,0.06);
}
.formula-popup button:hover {
    background: #1976d2;
    color: #fff;
    border-color: #1976d2;
}
.preview-label {
    font-size: 1.04rem;
    color: #3d5068;
    margin-top: 12px;
    margin-bottom: 2px;
    font-weight: 500;
}
.preview-box {
    background: linear-gradient(90deg,#f5f7fa 0%, #e3f0fc 100%);
    min-height: 38px;
    padding: 13px 14px;
    border-radius: 8px;
    font-size: 1.28rem;
    color: #1a253c;
    margin-bottom: 10px;
    margin-top: 2px;
    border: 1.5px solid #e2e8f0;
    box-shadow: 0 2px 8px 0 rgba(31,38,135,0.06);
    overflow-x: auto;
    font-family: inherit;
}
button[type="submit"] {
    margin-top: 18px;
    width: 100%;
    padding: 15px;
    background: linear-gradient(90deg,#1976d2 0%, #42a5f5 100%);
    color: white;
    border: none;
    border-radius: 9px;
    font-size: 1.16rem;
    font-weight: 600;
    letter-spacing: 0.8px;
    cursor: pointer;
    box-shadow: 0 3px 14px 0 rgba(25, 118, 210, 0.15);
    transition: background 0.14s, box-shadow 0.14s;
}
button[type="submit"]:hover {
    background: linear-gradient(90deg,#1565c0 0%, #2196f3 100%);
    box-shadow: 0 6px 24px 0 rgba(25, 118, 210, 0.18);
}
.back-link {
    text-align: center;
    margin-top: 24px;
}
.back-link a {
    color: #1976d2;
    font-weight: 500;
    text-decoration: none;
    font-size: 1.08rem;
    letter-spacing: 0.3px;
    transition: color 0.13s;
}
.back-link a:hover {
    color: #0d47a1;
    text-decoration: underline;
}
.remove-variant-btn {
    margin-left: 5px;
    color: #dc3545;
    background: none;
    border: none;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    width: 26px;
    height: 26px;
    border-radius: 50%;
    line-height: 18px;
    text-align: center;
    transition: background 0.15s, color 0.15s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}
.remove-variant-btn:hover {
    background: #f8d7da;
    color: #a71d2a;
}
.single-choice-row, .multiple-choice-row, .matching-row, .ordering-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 6px;
    background: #f5f8fd;
    border-radius: 7px;
    padding: 8px 10px 8px 10px;
    box-shadow: 0 1px 7px 0 rgba(49,130,206,0.04);
}
.single-choice-row input[type="text"],
.multiple-choice-row input[type="text"],
.matching-row input[type="text"],
.ordering-row input[type="text"] {
    flex: 1 1 auto;
    font-size: 1.08rem;
    background: #fff;
    border: 1.1px solid #c8d3e1;
    border-radius: 6px;
}
.variant-preview {
    margin-left: 12px;
    color: #1976d2;
    font-size: 1.18rem;
    min-width: 40px;
    min-height: 28px;
    font-family: inherit;
}
.variant-image-input { width:130px; font-size:.75rem; background:#fff; border:1px solid #c8d3e1; border-radius:6px; padding:4px; }
.img-thumb {max-height:42px; max-width:60px; display:inline-block; margin-left:6px; border:1px solid #e2e8f0; border-radius:4px; object-fit:cover;}
@media (max-width:700px){
    .container { max-width: 98vw; padding: 4vw 2vw 5vw 2vw;}
    h2 {font-size: 1.49rem;}
    .formula-popup {min-width: 96vw;}
    .formula-popup button, .preview-box {font-size: 1rem;}
    .single-choice-row, .multiple-choice-row, .matching-row, .ordering-row {font-size: 0.97rem; padding: 5px 6px;}
}
        /* === Enhanced variant cards === */
        .variant-card{position:relative;display:grid;grid-template-columns:1fr auto auto auto;grid-template-rows:auto auto;grid-column-gap:10px;align-items:start;padding:10px 12px 12px 12px;margin-bottom:10px;border:1px solid rgba(255,255,255,0.25);background:rgba(255,255,255,0.35);backdrop-filter:blur(10px);border-radius:14px;box-shadow:0 4px 14px rgba(0,0,0,0.08);animation:fadeIn .35s ease;}
        .variant-card input[type=text]{background:#ffffffd9;border:1px solid #c9d6e5;border-radius:8px;padding:10px 12px;font-size:.95rem;box-shadow:0 1px 2px rgba(0,0,0,0.04);transition:border-color .18s,box-shadow .18s;width:100%;}
        .variant-card input[type=text]:focus{outline:none;border-color:#1976d2;box-shadow:0 0 0 2px #1976d233;}
        .variant-card .correct-box{display:flex;align-items:center;gap:4px;font-size:.8rem;margin-top:6px;color:#123;}
        .variant-card .remove-btn{position:absolute;top:6px;right:6px;background:rgba(255,255,255,0.55);border:1px solid #d33;padding:0 7px;height:26px;display:flex;align-items:center;justify-content:center;color:#d33;font-weight:700;font-size:15px;border-radius:8px;cursor:pointer;transition:.18s;}
        .variant-card .remove-btn:hover{background:#d33;color:#fff;}
        .variant-card .file-wrap{display:flex;align-items:center;gap:8px;margin-top:6px;}
        .variant-card .file-input{position:relative;overflow:hidden;display:inline-flex;align-items:center;justify-content:center;background:#1976d2;color:#fff;border:none;padding:6px 12px;border-radius:7px;font-size:.72rem;cursor:pointer;font-weight:600;letter-spacing:.5px;box-shadow:0 3px 10px rgba(25,118,210,.3);transition:.18s;}
        .variant-card .file-input:hover{background:#125a9b;}
        .variant-card .file-input input{position:absolute;inset:0;opacity:0;cursor:pointer;}
        .variant-card .img-thumb{max-height:54px;max-width:72px;border:2px solid #fff;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.18);transition:transform .25s, box-shadow .25s;object-fit:cover;display:none;background:#f8fbff;}
        .variant-card .img-thumb.show{display:inline-block;}
        .variant-card .img-thumb:hover{transform:scale(1.9) translateY(4px);z-index:10;box-shadow:0 6px 24px rgba(0,0,0,.35);}
        .variant-card .preview-math{grid-column:1 / -1;margin-top:6px;font-size:.85rem;min-height:20px;color:#154;}
        .variant-section-title{margin-top:26px;font-weight:600;font-size:1rem;color:#1b3552;letter-spacing:.5px;}
        .add-variant-btn{margin-top:6px;background:#0d6efd;color:#fff;border:none;padding:10px 16px;border-radius:11px;font-size:.8rem;cursor:pointer;font-weight:600;letter-spacing:.4px;box-shadow:0 4px 14px rgba(13,110,253,.3);transition:.18s;}
        .add-variant-btn:hover{background:#0a58ca;}
        .variant-type-wrap{margin-top:4px;}
        .variant-type-wrap input{transform:scale(1.05);}
        .variant-inline{display:flex;flex-wrap:wrap;gap:10px;}
        .variant-inline > *{flex:1 1 230px;}
        @media (max-width:680px){.variant-card{grid-template-columns:1fr auto;grid-template-rows:auto auto auto;}.variant-card .file-wrap{flex-wrap:wrap;}.variant-card .remove-btn{top:4px;right:4px;}}
        /* === Compact override (simpler & smaller) === */
        .variant-card{display:flex;flex-wrap:wrap;align-items:center;gap:8px;padding:8px 10px;margin-bottom:8px;background:#f7fafd;border:1px solid #d9e2ec;border-radius:8px;box-shadow:none;backdrop-filter:none;}
        .variant-card input[type=text]{padding:6px 8px;font-size:.82rem;border:1px solid #c4ced8;background:#fff;border-radius:6px;box-shadow:none;}
        .variant-card .file-wrap{display:flex;align-items:center;gap:6px;margin-top:0;}
        .variant-card .file-input{background:#eef4fa;color:#123;border:1px solid #c5d3e0;padding:4px 8px;font-size:.62rem;border-radius:6px;box-shadow:none;letter-spacing:.3px;}
        .variant-card .file-input:hover{background:#dbe7f1;}
        .variant-card .remove-btn{position:static;order:99;height:22px;width:22px;padding:0;font-size:13px;border:1px solid #e4b6bb;background:#fff;color:#c92828;border-radius:6px;}
        .variant-card .remove-btn:hover{background:#c92828;color:#fff;}
        .variant-card .correct-box{margin-top:0;font-size:.65rem;gap:3px;color:#1a2b38;}
        .variant-card .correct-box input{margin:0;}
        .variant-card .img-thumb{max-height:40px;max-width:55px;border:1px solid #d0dbe5;border-radius:6px;box-shadow:none;transition:none;}
        .variant-card .img-thumb:hover{transform:none;box-shadow:none;}
        .variant-card .preview-math{display:none;}
        /* New ultra-compact row layout */
        .variant-row{display:flex;align-items:center;gap:8px;padding:6px 8px;margin-bottom:6px;background:#f4f7fb;border:1px solid #d9e3ec;border-radius:8px;}
        .variant-row input[type=text]{flex:1 1 auto;padding:7px 9px;font-size:.8rem;border:1px solid #c4ced8;border-radius:6px;background:#fff;}
        .variant-row .file-btn{position:relative;display:inline-flex;align-items:center;justify-content:center;padding:6px 10px;font-size:.6rem;font-weight:600;background:#0d6efd;color:#fff;border:none;border-radius:6px;cursor:pointer;letter-spacing:.4px;}
        .variant-row .file-btn input{position:absolute;inset:0;opacity:0;cursor:pointer;}
        .variant-row .img-thumb{height:34px;width:44px;object-fit:cover;border:1px solid #d0dbe5;border-radius:6px;display:none;}
        .variant-row .img-thumb.show{display:inline-block;}
        .variant-row .correct-box{display:flex;align-items:center;gap:4px;font-size:.65rem;white-space:nowrap;}
        .variant-row .remove-btn{background:#fff;border:1px solid #e0b9bd;color:#c92a2a;width:22px;height:22px;border-radius:6px;font-size:13px;display:flex;align-items:center;justify-content:center;cursor:pointer;}
        .variant-row .remove-btn:hover{background:#c92a2a;color:#fff;}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    {% load static %}
    <link rel="stylesheet" href="{% static 'teacher_panel/css/formula_panel.css' %}">
</head>
<body>
    <div class="container">
        <h2>Yangi savol (Gurusiz) qo‘shish</h2>
        {% if error %}<div style="background:#ffe5e5;color:#a40000;padding:10px 14px;border-radius:8px;font-weight:600;">{{ error }}</div>{% endif %}
        {% if success %}<div style="background:#e5ffe9;color:#0d6b1d;padding:10px 14px;border-radius:8px;font-weight:600;">{{ success }}</div>{% endif %}
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="target" value="{{ target }}" />
            {% if target == 'student' %}
            <label for="semester">Semestr</label>
            <select name="semester" id="semester" required>
                <option value="">Semestr tanlang...</option>
                {% for sem in semesters %}
                    <option value="{{ sem.id }}" {% if selected.semester == sem.id|stringformat:'s' %}selected{% endif %}>{{ sem.number }}</option>
                {% endfor %}
            </select>
            {% elif target == 'tutor' %}
            <label for="kafedra">Kafedra</label>
            <select name="kafedra" id="kafedra" required>
                <option value="">Kafedra tanlang...</option>
                {% for k in kafedralar %}
                    <option value="{{ k.id }}" {% if selected.kafedra == k.id|stringformat:'s' %}selected{% endif %}>{{ k.name }}</option>
                {% endfor %}
            </select>
            {% elif target == 'employee' %}
            <label for="bulim">Bo'lim</label>
            <select name="bulim" id="bulim" required>
                <option value="">Bo'lim tanlang...</option>
                {% for b in bulimlar %}
                    <option value="{{ b.id }}" {% if selected.bulim == b.id|stringformat:'s' %}selected{% endif %}>{{ b.name }}</option>
                {% endfor %}
            </select>
            {% endif %}
            <label for="subject">Fan</label>
            <select name="subject" id="subject" required>
                <option value="">Fan tanlang...</option>
                {% for subj in subjects %}
                    <option value="{{ subj.id }}" {% if selected.subject == subj.id|stringformat:'s' %}selected{% endif %}>{{ subj.name }}</option>
                {% endfor %}
            </select>
            <small style="display:block;margin:6px 0 14px;color:#555;font-size:0.9rem;">Yangi TZ: savol endi guruhga biriktirilmaydi. Keyinchalik test → guruh bog‘lash orqali ishlatiladi.</small>
            <label for="question_type">Savol turi</label>
            <select name="question_type" id="question_type" required>
                <option value="">Tanlang...</option>
                {% for code,label in question_types %}
                    <option value="{{ code }}" {% if selected.question_type == code %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
            <label for="text">Savol matni</label>
            <div class="textarea-wrapper">
                <textarea name="text" id="text" required>{{ selected.text }}</textarea>
            </div>
            <label for="question_image">Rasm (ixtiyoriy)</label>
            <input type="file" name="question_image" id="question_image" accept="image/*" />
            <!-- Answer type dynamic blocks (reuse existing JS below) -->
            <!-- Single choice container -->
            <div id="single_choice_block" style="display:none;margin-top:18px;">
                <h3 style="margin:6px 0 10px;">Variantlar (bitta to‘g‘ri)</h3>
                <div id="single_choice_rows"></div>
                <button type="button" id="add_single_option" style="margin-top:8px;">➕ Variant qo‘shish</button>
            </div>
            <div id="multiple_choice_block" style="display:none;margin-top:18px;">
                <h3 style="margin:6px 0 10px;">Variantlar (ko‘p to‘g‘ri)</h3>
                <div id="multiple_choice_rows"></div>
                <button type="button" id="add_multi_option" style="margin-top:8px;">➕ Variant qo‘shish</button>
            </div>
            <div id="fill_blank_block" style="display:none;margin-top:18px;">
                <label for="fill_blank_answer">To‘g‘ri javob:</label>
                <input type="text" name="fill_blank_answer" id="fill_blank_answer" />
            </div>
            <div id="true_false_block" style="display:none;margin-top:18px;">
                <label>To‘g‘ri javob:</label>
                <select name="true_false_answer" id="true_false_answer">
                    <option value="true">To‘g‘ri</option>
                    <option value="false">Yolg‘on</option>
                </select>
            </div>
            <div id="matching_block" style="display:none;margin-top:18px;">
                <h3 style="margin:6px 0 10px;">Moslash juftliklari</h3>
                <div id="matching_rows"></div>
                <button type="button" id="add_matching_row" style="margin-top:8px;">➕ Juftlik qo‘shish</button>
            </div>
            <div id="ordering_block" style="display:none;margin-top:18px;">
                <h3 style="margin:6px 0 10px;">Tartib elementlari</h3>
                <div id="ordering_rows"></div>
                <button type="button" id="add_ordering_row" style="margin-top:8px;">➕ Element qo‘shish</button>
            </div>
            <button type="submit">Saqlash</button>
        </form>
        <div class="back-link"><a href="/api/teacher/dashboard/">⬅️ Panelga qaytish</a></div>
    </div>
    <script>
(function(){
    const qtSel = document.getElementById('question_type');
    const blocks = {
        single_choice: document.getElementById('single_choice_block'),
        multiple_choice: document.getElementById('multiple_choice_block'),
        fill_in_blank: document.getElementById('fill_blank_block'),
        true_false: document.getElementById('true_false_block'),
        matching: document.getElementById('matching_block'),
        sentence_ordering: document.getElementById('ordering_block')
    };
    function hideAll(){ Object.values(blocks).forEach(b=>{ if(b) b.style.display='none'; }); }
    function showFor(val){ hideAll(); if(blocks[val]) blocks[val].style.display='block'; }
    qtSel && qtSel.addEventListener('change', e=> showFor(e.target.value));
    if(qtSel && qtSel.value) showFor(qtSel.value);
    // Dynamic add/remove rows (single & multi similar)
    const singleWrap = document.getElementById('single_choice_rows');
    const multiWrap = document.getElementById('multiple_choice_rows');
    function makeSingleRow(idx){
        const div = document.createElement('div');
        div.className='single-choice-row';
        div.innerHTML = `<input type='radio' name='single_correct' value='${idx}'><input type='text' name='single_option_${idx}' placeholder='Variant ${idx}'><input type='file' name='single_image_${idx}' accept='image/*'><button type='button' class='remove-variant-btn'>&times;</button>`;
        div.querySelector('.remove-variant-btn').onclick=()=>div.remove();
        return div;
    }
    function makeMultiRow(idx){
        const div = document.createElement('div');
        div.className='multiple-choice-row';
        div.innerHTML = `<input type='checkbox' name='multi_correct_${idx}'><input type='text' name='multi_option_${idx}' placeholder='Variant ${idx}'><input type='file' name='multi_image_${idx}' accept='image/*'><button type='button' class='remove-variant-btn'>&times;</button>`;
        div.querySelector('.remove-variant-btn').onclick=()=>div.remove();
        return div;
    }
    document.getElementById('add_single_option')?.addEventListener('click',()=>{
        const c = singleWrap.children.length+1; singleWrap.appendChild(makeSingleRow(c));
    });
    document.getElementById('add_multi_option')?.addEventListener('click',()=>{
        const c = multiWrap.children.length+1; multiWrap.appendChild(makeMultiRow(c));
    });
    // Seed first two rows
    if(singleWrap && singleWrap.children.length===0){ for(let i=1;i<=2;i++) singleWrap.appendChild(makeSingleRow(i)); }
    if(multiWrap && multiWrap.children.length===0){ for(let i=1;i<=2;i++) multiWrap.appendChild(makeMultiRow(i)); }
    // Matching
    const matchWrap = document.getElementById('matching_rows');
    function makeMatchRow(i){
        const d=document.createElement('div');d.className='matching-row';
        d.innerHTML = `<input type='text' name='matching_left_${i}' placeholder='Chap ${i}'><input type='text' name='matching_right_${i}' placeholder='O‘ng ${i}'><input type='file' name='matching_image_${i}' accept='image/*'><button type='button' class='remove-variant-btn'>&times;</button>`;
        d.querySelector('.remove-variant-btn').onclick=()=>d.remove();
        return d;
    }
    document.getElementById('add_matching_row')?.addEventListener('click',()=>{ const c=matchWrap.children.length+1; matchWrap.appendChild(makeMatchRow(c)); });
    if(matchWrap && matchWrap.children.length===0){ matchWrap.appendChild(makeMatchRow(1)); }
    // Ordering
    const ordWrap = document.getElementById('ordering_rows');
    function makeOrdRow(i){ const d=document.createElement('div'); d.className='ordering-row'; d.innerHTML=`<input type='text' name='ordering_${i}' placeholder='Element ${i}'><button type='button' class='remove-variant-btn'>&times;</button>`; d.querySelector('.remove-variant-btn').onclick=()=>d.remove(); return d; }
    document.getElementById('add_ordering_row')?.addEventListener('click',()=>{ const c=ordWrap.children.length+1; ordWrap.appendChild(makeOrdRow(c)); });
    if(ordWrap && ordWrap.children.length===0){ for(let i=1;i<=2;i++) ordWrap.appendChild(makeOrdRow(i)); }
})();
</script>
</body>
</html>