<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Testni guruhlarga biriktirish</title>
<style>
body{font-family:Inter,Arial,sans-serif;background:url('/static/main/1.png') center/cover fixed;margin:0;padding:0;}
.container{max-width:880px;margin:40px auto;padding:34px 34px 42px;background:rgba(255,255,255,.14);backdrop-filter:blur(18px);border:1px solid rgba(255,255,255,.25);border-radius:26px;box-shadow:0 10px 40px -8px rgba(0,0,0,.45);color:#fff;}
h1{margin:0 0 20px;font-size:2.05rem;font-weight:700;letter-spacing:.6px;}
.info{display:flex;flex-wrap:wrap;gap:16px;margin:6px 0 22px;font-size:.85rem;}
.badge{background:linear-gradient(135deg,#5fa8ff,#2b6bff);padding:6px 14px;border-radius:999px;font-weight:600;letter-spacing:.4px;}
.flex{display:flex;gap:30px;flex-wrap:wrap;}
.col{flex:1 1 320px;min-width:280px;}
.search-box{margin-bottom:10px;}
.search-box input{width:100%;padding:11px 14px;border:1px solid rgba(255,255,255,.28);border-radius:14px;background:rgba(0,0,0,.35);color:#fff;outline:none;}
.list{max-height:380px;overflow:auto;border:1px solid rgba(255,255,255,.25);border-radius:16px;background:rgba(0,0,0,.35);padding:6px;display:flex;flex-direction:column;gap:4px;}
.item{display:flex;align-items:center;gap:10px;padding:8px 10px;border-radius:11px;background:rgba(255,255,255,.08);cursor:pointer;font-size:.82rem;font-weight:500;transition:.25s;}
.item:hover{background:rgba(255,255,255,.16);} .item input{margin:0;}
.actions{display:flex;gap:10px;margin:10px 0 14px;flex-wrap:wrap;}
.actions button{padding:8px 14px;border:none;border-radius:10px;background:linear-gradient(135deg,#4d92ff,#1c62e8);color:#fff;font-weight:600;cursor:pointer;font-size:.75rem;letter-spacing:.4px;}
.actions button.secondary{background:rgba(255,255,255,.18);}
.submit-btn{margin-top:26px;width:100%;padding:15px 18px;border:none;border-radius:16px;background:linear-gradient(135deg,#5fa8ff,#2b6bff);color:#fff;font-size:1.05rem;font-weight:700;cursor:pointer;letter-spacing:.6px;box-shadow:0 8px 25px -6px rgba(0,0,0,.45);}
.submit-btn:hover{transform:translateY(-2px);} a.back{display:inline-block;margin-top:16px;color:#fff;text-decoration:none;font-weight:500;}
.count{font-size:.7rem;opacity:.8;margin-left:auto;}
</style>
</head>
<body>
<div class="container">
<h1>Testni Guruhlarga Biriktirish</h1>
{% if error %}
  <div style="background:rgba(255,60,60,.18);border:1px solid rgba(255,60,60,.5);padding:14px 16px;border-radius:14px;margin:0 0 18px;font-size:.8rem;line-height:1.35;">
    <strong style="color:#ffb4b4;display:block;margin-bottom:6px;">⚠️ {{ error }}</strong>
    {% if conflict_details %}
      <ul style="margin:0;padding-left:18px;max-height:140px;overflow:auto;">
        {% for c in conflict_details %}
          <li style="margin-bottom:4px;">
            <span style="font-weight:600;">{{ c.group_name }}</span>:
            {% for t in c.tests %}
              <a href="/api/controller-panel/edit-test/{{ t.id }}/" style="color:#ffd9d9;text-decoration:underline;">{{ t.title }}</a>{% if not forloop.last %}, {% endif %}
            {% endfor %}
          </li>
        {% endfor %}
      </ul>
      <p style="margin:8px 0 0;opacity:.75;">Ushbu guruh(lar)ni belgilashdan olib tashlang yoki mavjud testlarni o'zgartiring.</p>
    {% endif %}
  </div>
{% endif %}
<div class="info">
<span class="badge">Fan: {{ test.subject.name }}</span>
{% if test.semester %}<span class="badge">Semestr: {{ test.semester.number }}</span>{% endif %}
<span class="badge">Savollar: {{ test.question_count }}</span>
<span class="badge">Ball: {{ test.total_score }}</span>
</div>
<form method="post">{% csrf_token %}
<div class="flex">
<div class="col">
<h3 style="margin-top:0;margin-bottom:10px;">Guruhlar</h3>
<div class="search-box"><input type="text" id="group-search" placeholder="Qidirish..." autocomplete="off"></div>
<div class="actions">
<button type="button" id="select-all">Hammasi</button>
<button type="button" id="clear-all" class="secondary">Tozalash</button>
</div>
<div class="list" id="group-list">
{% for g in groups %}
<label class="item" data-name="{{ g.name|lower }}">
    <input type="checkbox" name="group_ids" value="{{ g.id }}" {% if g.id in assigned_ids %}checked{% endif %}>
    <span>{{ g.name }}</span>
</label>
{% endfor %}
</div>
</div>
<div class="col">
<h3 style="margin-top:0;margin-bottom:10px;">Tanlangan</h3>
<div class="list" id="selected-list"></div>
<p style="font-size:.72rem;opacity:.8;margin-top:8px;">Testni guruhga biriktirish – talabalar shu testni ko‘rishi uchun shart.</p>
</div>
</div>
<button type="submit" class="submit-btn">Saqlash</button>
</form>
<a href="/api/controller-panel/dashboard/" class="back">⬅️ Orqaga</a>
</div>
<script>
(function(){
 const search=document.getElementById('group-search');
 const list=document.getElementById('group-list');
 const selectedBox=document.getElementById('selected-list');
 const selectAll=document.getElementById('select-all');
 const clearAll=document.getElementById('clear-all');
 function renderSelected(){
   selectedBox.innerHTML='';
   const checked=[...list.querySelectorAll('input[type=checkbox]:checked')];
   if(!checked.length){selectedBox.innerHTML='<div style="opacity:.6;font-size:.75rem;padding:8px;">Tanlanmagan</div>';return;}
   checked.forEach(ch=>{const wrap=document.createElement('div');wrap.className='item';wrap.style.background='rgba(0,0,0,.4)';wrap.innerHTML=`<span>${ch.parentElement.textContent.trim()}</span><button type='button' style='margin-left:auto;background:none;border:none;color:#ff9b9b;font-weight:700;font-size:16px;cursor:pointer;'>&times;</button>`;wrap.querySelector('button').onclick=()=>{ch.checked=false;renderSelected();};selectedBox.appendChild(wrap);});
 }
 list.addEventListener('change',renderSelected);renderSelected();
 search.addEventListener('input',()=>{const q=search.value.toLowerCase();[...list.children].forEach(l=>{l.style.display=l.dataset.name.includes(q)?'flex':'none';});});
 selectAll.addEventListener('click',()=>{[...list.querySelectorAll('input[type=checkbox]')].forEach(c=>c.checked=true);renderSelected();});
 clearAll.addEventListener('click',()=>{[...list.querySelectorAll('input[type=checkbox]')].forEach(c=>c.checked=false);renderSelected();});
})();
</script>
</body>
</html>
