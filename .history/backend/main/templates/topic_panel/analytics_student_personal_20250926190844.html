{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  <div class="d-flex align-items-center mb-4">
    <h3 class="me-auto">Shaxsiy statistika: {{ topic.title }}</h3>
    <a href="/api/topic-panel/student/panel/" class="btn btn-outline-secondary me-2">‚Üê Orqaga</a>
  </div>
  {% if items %}
  <div class="table-responsive shadow-sm rounded bg-white p-3">
    <table class="table table-striped align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Test</th>
          <th>Ball</th>
          <th>Foiz</th>
          <th>To'g'ri / Jami</th>
          <th>Vaqt</th>
        </tr>
      </thead>
      <tbody>
        {% for i in items %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ i.test_title }}</td>
            <td><span class="badge bg-success">{{ i.score }}</span></td>
            <td>{{ i.percent }}%</td>
            <td>{{ i.correct }} / {{ i.total_q }}</td>
            <td>{{ i.finished_at|date:'Y-m-d H:i' }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <canvas id="statsChart" height="140" class="mt-4"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    (function(){
      const raw = {{ items|safe }};
      const labels = raw.map(r=>r.test_title);
      const perc = raw.map(r=>r.percent);
      const ctx = document.getElementById('statsChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {labels, datasets:[{label: 'Foiz', data: perc, backgroundColor: 'rgba(102,126,234,0.6)', borderColor:'#667eea', borderWidth:1}]},
        options:{scales:{y:{beginAtZero:true,max:100}}}
      });
    })();
  </script>
  {% else %}
    <div class="alert alert-info">Hali yakunlangan testlaringiz yo'q.</div>
  {% endif %}
</div>
{% endblock %}
